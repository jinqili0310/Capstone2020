<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Part 1</title>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="library/pixi.min.js"></script>
</head>

<body>
    <!-- <canvas></canvas> -->
    <script type="text/javascript">

        class utils {
            static debounce(callback, time) {
                var timeout;
                return function () {
                    clearTimeout(timeout);
                    timeout = setTimeout(callback, time);
                };
            }
            static random(min, max) {
                if (max == null) { max = min; min = 0; }
                if (min > max) { var tmp = min; min = max; max = tmp; }
                return min + (max - min) * Math.random();
            }
        }

        class flake extends PIXI.Sprite {
            constructor(texture) {
                super(texture);
                this.anchor.set(0.5);
                this.scale.set(utils.random(0.05, 0.2));

                this.vy = this.scale.y / 30;
                this.vx = this.scale.y / 24;
                this.noy = utils.random(-200, -100);
            }
            reset(w, h, first = true, wind) {

                this.ox = utils.random(-200 - 100 * wind, w + 200 + 100 * wind);
                if (first) {
                    this.oy = utils.random(-200, h + 200);
                    this.oframe = utils.random(0, 200);
                }
                this.frame = this.oframe;
                this.position.set(this.ox, first ? this.oy : this.noy);
                // this.wind=0;
            }
            next(w, h, wind, down = 0) {
                this.frame++;
                let y = this.position.y + this.vy * this.frame;
                let x = this.ox + Math.cos(this.vx * this.frame) * 100;
                this.position.set(x, y);
                if (y > h + 200) {
                    this.reset(w, h, false, wind, down);
                }
                if (this.x > w + 200) {
                    this.ox -= (w + 200);
                }
                if (this.x < -200) {
                    this.ox += (w + 200);
                }
                if (this.y < -200) {
                    this.y = (h + 200);
                }
                this.ox -= wind;//*(this.vx*30);
                this.position.y -= down * (this.vy) * 100;
            }
        }

        let type = "WebGL";
        if (!PIXI.utils.isWebGLSupported()) {
            type = "canvas"
        };
        PIXI.utils.sayHello(type);

        let Application = PIXI.Application,
            loader = PIXI.loader,
            resources = PIXI.loader.resources,
            Sprite = PIXI.Sprite;

        let app = new Application({
            width: window.innerWidth,
            height: window.innerHeight,
            antialias: true,
            transparent: false,
            resolution: 1
        });
        document.body.appendChild(app.view);

        app.renderer.view.style.position = "absolute";
        app.renderer.view.style.display = "block";
        app.renderer.backgroundColor = 0xffffff;
        app.renderer.autoResize = true;
        app.renderer.resize(window.innerWidth, window.innerHeight);

        loader
            .add("snowflake", "assets/snow.png")
            .add("assets/p1s1s0.png")
            .add("assets/p1s1s1.png")
            .add("assets/p1s2s0.png")
            .add("assets/p1s2s1.png")
            .add("assets/p1s3s0.png")
            .add("assets/p1s3s1.png")
            .load(setup);

        let s1s0, s1s1, s2s0, s2s1, s3s0, s3s1, snows;


        function setup() {
            //MARK: snow!!!!
            snows = new PIXI.ParticleContainer(this.totalFlakes, {
                scale: true,
                position: true,
                rotation: false,
                uvs: false,
                tint: false
            });

            s1s0 = new Sprite(resources["assets/p1s1s0.png"].texture);
            app.stage.addChild(s1s0);
            s1s0.height = window.innerHeight * 0.9;
            s1s0.width = s1s0.height;
            s1s0.x = window.innerWidth / 2 - s1s0.width / 2;
            s1s0.y = window.innerHeight / 2 - s1s0.height / 2;
            s1s0.alpha = 0;

            s1s1 = new Sprite(resources["assets/p1s1s1.png"].texture);
            app.stage.addChild(s1s1);
            s1s1.height = window.innerHeight * 0.9;
            s1s1.width = s1s1.height;
            s1s1.x = window.innerWidth / 2 - s1s1.width / 2;
            s1s1.y = window.innerHeight / 2 - s1s1.height / 2;
            s1s1.alpha = 0;

            var s1Array = [
                (() => {
                    s1s0.alpha = 1;
                    s1s1.alpha = 0;
                }),
                (() => {
                    s1s0.alpha = 0;
                    s1s1.alpha = 1;
                })
            ];
            var index = 0;
            setInterval(() => {
                if (index < s1Array.length) {
                    //console.log(index);
                    s1Array[index]();
                }
                else {
                    index = -1;
                };
                index += 1;
            }, 150);

            s2s0 = new Sprite(resources["assets/p1s2s0.png"].texture);
            app.stage.addChild(s2s0);
            s2s0.height = window.innerHeight * 0.9;
            s2s0.width = s2s0.height;
            s2s0.x = window.innerWidth / 2 - s2s0.width / 2;
            s2s0.y = window.innerHeight / 2 - s2s0.height / 2;
            s2s0.alpha = 0;

            s2s1 = new Sprite(resources["assets/p1s2s1.png"].texture);
            app.stage.addChild(s2s1);
            s2s1.height = window.innerHeight * 0.9;
            s2s1.width = s2s1.height;
            s2s1.x = window.innerWidth / 2 - s2s1.width / 2;
            s2s1.y = window.innerHeight / 2 - s2s1.height / 2;
            s2s1.alpha = 0;

            var s2Array = [
                (() => {
                    s2s0.alpha = 1;
                    s2s1.alpha = 0;
                }),
                (() => {
                    s2s0.alpha = 0;
                    s2s1.alpha = 1;
                })
            ];

            s3s0 = new Sprite(resources["assets/p1s3s0.png"].texture);
            app.stage.addChild(s3s0);
            s3s0.height = window.innerHeight * 0.9;
            s3s0.width = s3s0.height;
            s3s0.x = window.innerWidth / 2 - s3s0.width / 2;
            s3s0.y = window.innerHeight / 2 - s3s0.height / 2;
            s3s0.alpha = 0;

            s3s1 = new Sprite(resources["assets/p1s3s1.png"].texture);
            app.stage.addChild(s3s1);
            s3s1.height = window.innerHeight * 0.9;
            s3s1.width = s3s1.height;
            s3s1.x = window.innerWidth / 2 - s3s1.width / 2;
            s3s1.y = window.innerHeight / 2 - s3s1.height / 2;
            s3s1.alpha = 0;

            var s3Array = [
                (() => {
                    s3s0.alpha = 1;
                    s3s1.alpha = 0;
                }),
                (() => {
                    s3s0.alpha = 0;
                    s3s1.alpha = 1;
                })
            ];

            let text3 = new PIXI.Text("Click on anywhere to continue.", {
                font: "16px robotoMedium",
                fill: 0x000000
            });
            app.stage.addChild(text3);
            text3.x = window.innerWidth - text3.width;
            text3.y = 0;

            let bkg = new PIXI.Container();
            app.stage.addChild(bkg);
            bkg.interactive = true;
            bkg.hitArea = new PIXI.Rectangle(0, 0, window.innerWidth, window.innerHeight);
            bkg.on("pointerup", function () {
                console.log("next page");
                var index = 0;
                setInterval(() => {
                    if (index < s2Array.length) {
                        //console.log(index);
                        s2Array[index]();
                    }
                    else {
                        index = -1;
                    };
                    index += 1;
                }, 150);
                bkg.interactive = false;
                bkg2.interactive = true;
            }, this);

            let bkg2 = new PIXI.Container();
            app.stage.addChild(bkg2);
            bkg2.interactive = false;
            bkg2.hitArea = new PIXI.Rectangle(0, 0, window.innerWidth, window.innerHeight);
            bkg2.on("pointerup", function () {
                console.log("next page 2");
                var index = 0;
                setInterval(() => {
                    if (index < s3Array.length) {
                        //console.log(index);
                        s3Array[index]();
                    }
                    else {
                        index = -1;
                    };
                    index += 1;
                }, 150);
                bkg2.interactive = false;
                bkg3.interactive = true;
            }, this);

            let bkg3 = new PIXI.Container();
            app.stage.addChild(bkg3);
            bkg3.interactive = false;
            bkg3.hitArea = new PIXI.Rectangle(0, 0, window.innerWidth, window.innerHeight);
            bkg3.on("pointerup", function () {
                console.log("next page 3");
                window.location.href = "interval.html";
            }, this);

        }

    </script>
</body>

</html>